#!/usr/bin/env python3
import os, subprocess
from sys import exit

DIR = os.path.expanduser("~/docs/bookmarks") 
FILE = os.path.join(DIR, "bookmarks.txt")
ROFI_THEME = os.path.expanduser("~/.config/rofi/themes/bookmarks.rasi")

if not os.path.exists(FILE):
    with open(FILE, 'w') as f:
        f.write("[example] example content")

    subprocess.run(["notify-send", "--app-name", __file__, "--icon", "bookmarks", 
                    "You have no bookmarks", f"Please see {FILE} and add some."])

with open(FILE) as f:
    tags = []
    contents = []

    for line in f:
        tag, content = line.split(']', 1)
        tag = tag.removeprefix('[')
        
        tags.append(tag)
        contents.append(content)

try:
    result = subprocess.run(
        ["rofi", "-dmenu", "-p", "Select bookmark:", "-theme", ROFI_THEME],
        input='\n'.join(tags),
        text=True,
        capture_output=True,
        check=True
    )
except:
    exit(1)

selected_bookmark = contents[tags.index(result.stdout.strip())]

subprocess.run(["wtype", f"\"{selected_bookmark}\""])

